(()=>{"use strict";const e=window.wp.blocks,t=window.React,a=window.wp.i18n,l=window.wp.blockEditor,n=window.wp.components,i=window.wp.element;(0,e.registerBlockType)("bf-basic-guard/downloader",{edit:function({attributes:e,setAttributes:r}){const{file:o,text:d,displayMode:s,buttonWidthMode:c="auto",buttonWidthCustom:u="",buttonAlign:b="left"}=e,[g,m]=(0,i.useState)(""),[p,f]=(0,i.useState)(!1),[y,_]=(0,i.useState)([]),[x,h]=(0,i.useState)(""),[E,w]=(0,i.useState)(!1),v=(0,l.useBlockProps)(),{style:C,...k}=v;(0,i.useEffect)(()=>{o&&o.includes("..")?m((0,a.__)('無効なファイルパス: ".." は使用できません',"bf-basic-guard")):m("")},[o]);let B={};"full"===c?B={display:"block",width:"100%"}:"auto"===c?B={display:"inline-block"}:"custom"===c&&u&&(B={width:u,display:"block"}),"auto"!==c&&("center"===b?(B.marginLeft="auto",B.marginRight="auto"):"right"===b?(B.marginLeft="auto",B.marginRight=0):"left"===b&&(B.marginLeft=0,B.marginRight="auto"));let A={};"center"===b?A={textAlign:"center"}:"right"===b&&(A={textAlign:"right"});const R=async e=>{w(!0),h(e);try{const t=new FormData;t.append("action","bf_basic_guard_browse_files"),t.append("path",e),t.append("page","1"),t.append("nonce",window.bfBasicGuardEditor?.nonce||"");const a=await fetch(window.bfBasicGuardEditor?.ajaxUrl||window.ajaxurl,{method:"POST",body:t}),l=await a.json();l.success?_(l.data.items||[]):(_([]),console.error("ファイル取得エラー:",l.data))}catch(e){console.error("ファイル取得エラー:",e),_([])}finally{w(!1)}};return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(n.PanelBody,{title:(0,a.__)("ダウンロード設定","bf-basic-guard")},(0,t.createElement)("div",{style:{marginBottom:"12px"}},(0,t.createElement)("label",{style:{display:"block",marginBottom:"6px",fontWeight:"600"}},(0,a.__)("ファイルパス","bf-basic-guard")),(0,t.createElement)("div",{style:{display:"flex",gap:"8px"}},(0,t.createElement)(n.TextControl,{value:o,onChange:e=>{r({file:e})},placeholder:(0,a.__)("例: /path/to/file.pdf","bf-basic-guard"),style:{flex:1}}),(0,t.createElement)(n.Button,{variant:"secondary",onClick:()=>{f(!0),R("")},style:{flexShrink:0}},(0,a.__)("選択","bf-basic-guard")))),g&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!1},g),(0,t.createElement)(n.TextControl,{label:(0,a.__)("表示テキスト","bf-basic-guard"),value:d,onChange:e=>{r({text:e})}}),(0,t.createElement)(n.SelectControl,{label:(0,a.__)("表示モード","bf-basic-guard"),value:s,options:[{label:"ダウンロード",value:"download"},{label:"ブラウザ表示",value:"display"}],onChange:e=>{r({displayMode:e})}}),(0,t.createElement)(n.SelectControl,{label:(0,a.__)("ボタン幅","bf-basic-guard"),value:c,onChange:e=>{r({buttonWidthMode:e})},options:[{label:(0,a.__)("全幅","bf-basic-guard"),value:"full"},{label:(0,a.__)("ラベルに応じる","bf-basic-guard"),value:"auto"},{label:(0,a.__)("カスタム","bf-basic-guard"),value:"custom"}]}),"custom"===c&&(0,t.createElement)(n.TextControl,{label:(0,a.__)("カスタム幅（例: 200px, 50% など）","bf-basic-guard"),value:u,onChange:e=>{r({buttonWidthCustom:e})},placeholder:"200px"}))),(0,t.createElement)(l.BlockControls,null,(0,t.createElement)(l.AlignmentToolbar,{value:b,onChange:e=>r({buttonAlign:e||"left"}),alignmentControls:[{icon:"editor-alignleft",title:(0,a.__)("左","bf-basic-guard"),align:"left"},{icon:"editor-aligncenter",title:(0,a.__)("中央","bf-basic-guard"),align:"center"},{icon:"editor-alignright",title:(0,a.__)("右","bf-basic-guard"),align:"right"}]})),(0,t.createElement)("div",{...k,style:{...k.style,...A}},(0,t.createElement)("div",{className:"bf-download-container",style:{...C,...B}},d||(0,a.__)("ダウンロード","bf-basic-guard"))),p&&(0,t.createElement)(n.Modal,{title:(0,a.__)("ファイルを選択","bf-basic-guard"),onRequestClose:()=>f(!1),style:{maxWidth:"800px",width:"90vw"}},(0,t.createElement)("div",{style:{padding:"16px"}},(0,t.createElement)("div",{style:{marginBottom:"16px",padding:"12px",backgroundColor:"#f1f1f1",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"}},(0,t.createElement)("div",null,(0,t.createElement)("strong",null,(0,a.__)("現在のディレクトリ:","bf-basic-guard")),(0,t.createElement)("code",{style:{marginLeft:"8px"}},x||(0,a.__)("ルートディレクトリ","bf-basic-guard"))),x&&(0,t.createElement)(n.Button,{variant:"secondary",onClick:()=>{if(x){const e=x.split("/").slice(0,-1).join("/");R(e)}}},(0,a.__)("上の階層へ","bf-basic-guard"))),E&&(0,t.createElement)("div",{style:{textAlign:"center",padding:"20px"}},(0,a.__)("読み込み中...","bf-basic-guard")),!E&&(0,t.createElement)("div",{style:{maxHeight:"400px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px"}},0===y.length?(0,t.createElement)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},(0,a.__)("ファイルまたはディレクトリが見つかりませんでした。","bf-basic-guard")):(0,t.createElement)("table",{style:{width:"100%",borderCollapse:"collapse"}},(0,t.createElement)("thead",null,(0,t.createElement)("tr",{style:{backgroundColor:"#f9f9f9"}},(0,t.createElement)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"}},(0,a.__)("ファイル名","bf-basic-guard")),(0,t.createElement)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd",width:"100px"}},(0,a.__)("タイプ","bf-basic-guard")),(0,t.createElement)("th",{style:{padding:"12px",textAlign:"center",borderBottom:"1px solid #ddd",width:"80px"}},(0,a.__)("操作","bf-basic-guard")))),(0,t.createElement)("tbody",null,y.map((e,l)=>(0,t.createElement)("tr",{key:l,style:{borderBottom:"1px solid #eee"}},(0,t.createElement)("td",{style:{padding:"12px"}},(0,t.createElement)("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},(0,t.createElement)("span",{style:{fontSize:"16px"}},"directory"===e.type?"📁":"📄"),(0,t.createElement)("span",{style:{fontWeight:"directory"===e.type?"600":"normal"}},e.name))),(0,t.createElement)("td",{style:{padding:"12px",color:"#666"}},"directory"===e.type?(0,a.__)("ディレクトリ","bf-basic-guard"):(0,a.__)("ファイル","bf-basic-guard")),(0,t.createElement)("td",{style:{padding:"12px",textAlign:"center"}},"directory"===e.type?(0,t.createElement)(n.Button,{variant:"secondary",size:"small",onClick:()=>{return t=e.path,void R(t);var t}},(0,a.__)("開く","bf-basic-guard")):(0,t.createElement)(n.Button,{variant:"primary",size:"small",onClick:()=>{return t=e.path,r({file:t}),void f(!1);var t}},(0,a.__)("選択","bf-basic-guard")))))))),(0,t.createElement)("div",{style:{marginTop:"16px",display:"flex",justifyContent:"flex-end",gap:"8px"}},(0,t.createElement)(n.Button,{variant:"secondary",onClick:()=>f(!1)},(0,a.__)("キャンセル","bf-basic-guard"))))))},save:function({attributes:e}){const{file:a,text:n,displayMode:i,buttonWidthMode:r="auto",buttonWidthCustom:o="",buttonAlign:d="left"}=e,s=l.useBlockProps.save();let c={};"full"===r?c={display:"block",width:"100%"}:"auto"===r?c={display:"inline-block"}:"custom"===r&&o&&(c={width:o,display:"block"}),"auto"!==r&&("center"===d?(c.marginLeft="auto",c.marginRight="auto"):"right"===d?(c.marginLeft="auto",c.marginRight=0):"left"===d&&(c.marginLeft=0,c.marginRight="auto"));let u={};if("center"===d?u={textAlign:"center"}:"right"===d&&(u={textAlign:"right"}),!a)return(0,t.createElement)("div",{...s},(0,t.createElement)("div",{className:"bf-error"},"ファイルパスが指定されていません。"));const b=[s.className,"bf-download-container"].filter(Boolean).join(" ");return(0,t.createElement)("div",{style:u},(0,t.createElement)("div",{...s,className:b,style:{...s.style,...c},"data-file-path":a,"data-display-mode":i},n||"ダウンロード"))}})})();